<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fairness Monitoring Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } = Recharts;

    // Lucide icons as inline SVG components
    const AlertTriangle = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
        <line x1="12" y1="9" x2="12" y2="13"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    );

    const CheckCircle = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    );

    const TrendingUp = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
        <polyline points="17 6 23 6 23 12"/>
      </svg>
    );

    const Users = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    );

    const Activity = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
      </svg>
    );

    const FairnessDashboard = () => {
      const [currentWeek, setCurrentWeek] = useState(12);

      // Simulated trend data for DP Ratio and EO Gap over 12 weeks
      const trendData = [
        { week: 'W1', dpRatio: 0.52, eoGap: -0.35, blackReferrals: 42, whiteReferrals: 108 },
        { week: 'W2', dpRatio: 0.49, eoGap: -0.38, blackReferrals: 39, whiteReferrals: 115 },
        { week: 'W3', dpRatio: 0.48, eoGap: -0.39, blackReferrals: 38, whiteReferrals: 111 },
        { week: 'W4', dpRatio: 0.51, eoGap: -0.36, blackReferrals: 41, whiteReferrals: 109 },
        { week: 'W5', dpRatio: 0.53, eoGap: -0.34, blackReferrals: 44, whiteReferrals: 110 },
        { week: 'W6', dpRatio: 0.56, eoGap: -0.31, blackReferrals: 47, whiteReferrals: 112 },
        { week: 'W7', dpRatio: 0.59, eoGap: -0.28, blackReferrals: 51, whiteReferrals: 114 },
        { week: 'W8', dpRatio: 0.62, eoGap: -0.25, blackReferrals: 55, whiteReferrals: 116 },
        { week: 'W9', dpRatio: 0.67, eoGap: -0.21, blackReferrals: 61, whiteReferrals: 118 },
        { week: 'W10', dpRatio: 0.71, eoGap: -0.18, blackReferrals: 67, whiteReferrals: 120 },
        { week: 'W11', dpRatio: 0.75, eoGap: -0.14, blackReferrals: 73, whiteReferrals: 122 },
        { week: 'W12', dpRatio: 0.79, eoGap: -0.11, blackReferrals: 79, whiteReferrals: 124 }
      ];

      const currentMetrics = trendData[currentWeek - 1];

      const confusionData = [
        { group: 'White', TP: 105, FP: 6, FN: 54, TN: 414 },
        { group: 'Black', TP: 38, FP: 1, FN: 103, TN: 279 }
      ];

      const getDPStatus = (ratio) => {
        if (ratio >= 0.80) return { status: 'good', color: 'text-green-500', bg: 'bg-green-500/10' };
        if (ratio >= 0.70) return { status: 'warning', color: 'text-yellow-500', bg: 'bg-yellow-500/10' };
        return { status: 'critical', color: 'text-red-500', bg: 'bg-red-500/10' };
      };

      const getEOStatus = (gap) => {
        const absGap = Math.abs(gap);
        if (absGap <= 0.05) return { status: 'good', color: 'text-green-500', bg: 'bg-green-500/10' };
        if (absGap <= 0.15) return { status: 'warning', color: 'text-yellow-500', bg: 'bg-yellow-500/10' };
        return { status: 'critical', color: 'text-red-500', bg: 'bg-red-500/10' };
      };

      const dpStatus = getDPStatus(currentMetrics.dpRatio);
      const eoStatus = getEOStatus(currentMetrics.eoGap);

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white p-8">
          {/* Header */}
          <div className="mb-8">
            <div className="flex items-center justify-between mb-2">
              <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Fairness Monitoring Dashboard
              </h1>
              <div className="flex items-center gap-3 px-4 py-2 bg-slate-800/50 rounded-lg border border-slate-700">
                <Activity />
                <span className="text-sm font-medium">Live Monitoring</span>
              </div>
            </div>
            <p className="text-slate-400">Healthcare Risk Algorithm - Care Management Referrals</p>
            <p className="text-slate-500 text-sm">Week {currentWeek} | Last Updated: 2 minutes ago</p>
          </div>

          {/* Alert Banner */}
          {dpStatus.status === 'critical' || eoStatus.status === 'critical' ? (
            <div className="mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-3">
              <AlertTriangle />
              <div>
                <p className="font-semibold text-red-400">Fairness Alert Triggered</p>
                <p className="text-sm text-slate-300">Metrics below threshold. Escalation protocol initiated.</p>
              </div>
            </div>
          ) : dpStatus.status === 'good' && eoStatus.status === 'good' ? (
            <div className="mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg flex items-center gap-3">
              <CheckCircle />
              <div>
                <p className="font-semibold text-green-400">System Operating Within Fairness Thresholds</p>
                <p className="text-sm text-slate-300">All metrics meeting target benchmarks.</p>
              </div>
            </div>
          ) : (
            <div className="mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg flex items-center gap-3">
              <AlertTriangle />
              <div>
                <p className="font-semibold text-yellow-400">Approaching Fairness Thresholds</p>
                <p className="text-sm text-slate-300">Metrics improving but require continued monitoring.</p>
              </div>
            </div>
          )}

          {/* Key Metrics Cards */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            {/* DP Ratio Card */}
            <div className={`p-6 rounded-xl border ${dpStatus.bg} border-slate-700 backdrop-blur-sm`}>
              <div className="flex items-center justify-between mb-3">
                <span className="text-slate-400 text-sm font-medium">DP Ratio</span>
                {dpStatus.status === 'good' ? <CheckCircle /> : <AlertTriangle />}
              </div>
              <div className={`text-4xl font-bold mb-2 ${dpStatus.color}`}>
                {currentMetrics.dpRatio.toFixed(3)}
              </div>
              <div className="flex items-center gap-2 text-sm">
                <TrendingUp />
                <span className="text-slate-300">+0.27 from W1</span>
              </div>
              <div className="mt-3 pt-3 border-t border-slate-700">
                <span className="text-xs text-slate-500">Target: ≥0.80</span>
              </div>
            </div>

            {/* EO Gap Card */}
            <div className={`p-6 rounded-xl border ${eoStatus.bg} border-slate-700 backdrop-blur-sm`}>
              <div className="flex items-center justify-between mb-3">
                <span className="text-slate-400 text-sm font-medium">EO Gap</span>
                {eoStatus.status === 'good' ? <CheckCircle /> : <AlertTriangle />}
              </div>
              <div className={`text-4xl font-bold mb-2 ${eoStatus.color}`}>
                {currentMetrics.eoGap.toFixed(3)}
              </div>
              <div className="flex items-center gap-2 text-sm">
                <TrendingUp />
                <span className="text-slate-300">Improving</span>
              </div>
              <div className="mt-3 pt-3 border-t border-slate-700">
                <span className="text-xs text-slate-500">Target: ±0.05</span>
              </div>
            </div>

            {/* Black Referrals */}
            <div className="p-6 rounded-xl border bg-blue-500/5 border-slate-700 backdrop-blur-sm">
              <div className="flex items-center justify-between mb-3">
                <span className="text-slate-400 text-sm font-medium">Black Referrals</span>
                <Users />
              </div>
              <div className="text-4xl font-bold mb-2 text-blue-400">
                {currentMetrics.blackReferrals}
              </div>
              <div className="text-sm text-slate-300">
                {((currentMetrics.blackReferrals / 421) * 100).toFixed(1)}% of cohort
              </div>
              <div className="mt-3 pt-3 border-t border-slate-700">
                <span className="text-xs text-slate-500">Total Black: 421</span>
              </div>
            </div>

            {/* White Referrals */}
            <div className="p-6 rounded-xl border bg-purple-500/5 border-slate-700 backdrop-blur-sm">
              <div className="flex items-center justify-between mb-3">
                <span className="text-slate-400 text-sm font-medium">White Referrals</span>
                <Users />
              </div>
              <div className="text-4xl font-bold mb-2 text-purple-400">
                {currentMetrics.whiteReferrals}
              </div>
              <div className="text-sm text-slate-300">
                {((currentMetrics.whiteReferrals / 579) * 100).toFixed(1)}% of cohort
              </div>
              <div className="mt-3 pt-3 border-t border-slate-700">
                <span className="text-xs text-slate-500">Total White: 579</span>
              </div>
            </div>
          </div>

          {/* Charts Row */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            {/* DP Ratio Trend */}
            <div className="p-6 rounded-xl border border-slate-700 bg-slate-800/30 backdrop-blur-sm">
              <h3 className="text-lg font-semibold mb-4 text-slate-200">Demographic Parity Trend</h3>
              <ResponsiveContainer width="100%" height={250}>
                <LineChart data={trendData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                  <XAxis dataKey="week" stroke="#94a3b8" />
                  <YAxis stroke="#94a3b8" domain={[0, 1]} />
                  <Tooltip 
                    contentStyle={{ backgroundColor: '#1e293b', border: '1px solid #475569', borderRadius: '8px' }}
                    labelStyle={{ color: '#e2e8f0' }}
                  />
                  <ReferenceLine y={0.80} stroke="#10b981" strokeDasharray="3 3" label={{ value: 'Target', fill: '#10b981', fontSize: 12 }} />
                  <Line type="monotone" dataKey="dpRatio" stroke="#3b82f6" strokeWidth={3} dot={{ fill: '#3b82f6', r: 4 }} />
                </LineChart>
              </ResponsiveContainer>
            </div>

            {/* EO Gap Trend */}
            <div className="p-6 rounded-xl border border-slate-700 bg-slate-800/30 backdrop-blur-sm">
              <h3 className="text-lg font-semibold mb-4 text-slate-200">Equal Opportunity Gap Trend</h3>
              <ResponsiveContainer width="100%" height={250}>
                <LineChart data={trendData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                  <XAxis dataKey="week" stroke="#94a3b8" />
                  <YAxis stroke="#94a3b8" domain={[-0.5, 0.1]} />
                  <Tooltip 
                    contentStyle={{ backgroundColor: '#1e293b', border: '1px solid #475569', borderRadius: '8px' }}
                    labelStyle={{ color: '#e2e8f0' }}
                  />
                  <ReferenceLine y={0.05} stroke="#10b981" strokeDasharray="3 3" />
                  <ReferenceLine y={-0.05} stroke="#10b981" strokeDasharray="3 3" />
                  <ReferenceLine y={0} stroke="#64748b" strokeDasharray="2 2" />
                  <Line type="monotone" dataKey="eoGap" stroke="#a855f7" strokeWidth={3} dot={{ fill: '#a855f7', r: 4 }} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>

          {/* Confusion Matrix */}
          <div className="p-6 rounded-xl border border-slate-700 bg-slate-800/30 backdrop-blur-sm">
            <h3 className="text-lg font-semibold mb-4 text-slate-200">Confusion Matrix Breakdown</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {confusionData.map((group) => (
                <div key={group.group} className="p-4 rounded-lg bg-slate-900/50 border border-slate-700">
                  <h4 className="text-md font-semibold mb-3 text-slate-300">{group.group} Patients</h4>
                  <div className="grid grid-cols-2 gap-3">
                    <div className="p-3 rounded bg-green-500/10 border border-green-500/30">
                      <div className="text-xs text-slate-400 mb-1">True Positive</div>
                      <div className="text-2xl font-bold text-green-400">{group.TP}</div>
                    </div>
                    <div className="p-3 rounded bg-red-500/10 border border-red-500/30">
                      <div className="text-xs text-slate-400 mb-1">False Positive</div>
                      <div className="text-2xl font-bold text-red-400">{group.FP}</div>
                    </div>
                    <div className="p-3 rounded bg-orange-500/10 border border-orange-500/30">
                      <div className="text-xs text-slate-400 mb-1">False Negative</div>
                      <div className="text-2xl font-bold text-orange-400">{group.FN}</div>
                    </div>
                    <div className="p-3 rounded bg-blue-500/10 border border-blue-500/30">
                      <div className="text-xs text-slate-400 mb-1">True Negative</div>
                      <div className="text-2xl font-bold text-blue-400">{group.TN}</div>
                    </div>
                  </div>
                  <div className="mt-3 pt-3 border-t border-slate-700 grid grid-cols-3 gap-2 text-xs">
                    <div>
                      <span className="text-slate-500">TPR:</span>
                      <span className="ml-1 font-semibold text-slate-300">
                        {(group.TP / (group.TP + group.FN)).toFixed(3)}
                      </span>
                    </div>
                    <div>
                      <span className="text-slate-500">FPR:</span>
                      <span className="ml-1 font-semibold text-slate-300">
                        {(group.FP / (group.FP + group.TN)).toFixed(3)}
                      </span>
                    </div>
                    <div>
                      <span className="text-slate-500">FNR:</span>
                      <span className="ml-1 font-semibold text-slate-300">
                        {(group.FN / (group.TP + group.FN)).toFixed(3)}
                      </span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FairnessDashboard />);
  </script>
</body>
</html>
